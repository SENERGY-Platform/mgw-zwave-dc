package tests

import (
	"context"
	paho "github.com/eclipse/paho.mqtt.golang"
	"log"
	"sync"
	"testing"
	"time"
	"zwave2mqtt-connector/lib"
	"zwave2mqtt-connector/lib/configuration"
	"zwave2mqtt-connector/lib/connector"
	"zwave2mqtt-connector/lib/tests/docker"
)

func TestConnector(t *testing.T) {
	wg := &sync.WaitGroup{}
	defer wg.Wait()
	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()
	config, err := configuration.Load("../../config.json")
	if err != nil {
		t.Error(err)
		return
	}

	config.ZvaveValueEventTopic = "zwave2mqtt/#"
	config.ZwaveMqttApiTopic = "zwave2mqtt/_CLIENTS/ZWAVE_GATEWAY-SENERGY/api"
	config.ZwaveNetworkEventsTopic = "zwave2mqtt/_EVENTS/ZWAVE_GATEWAY-SENERGY"

	mgwMqttPort, _, err := docker.Mqtt(ctx, wg)
	if err != nil {
		t.Error(err)
		return
	}
	config.MgwMqttBroker = "tcp://localhost:" + mgwMqttPort
	config.MgwMqttUser = ""
	config.MgwMqttPw = ""
	config.MgwMqttClientId = "connector-mgw"

	zwaveMqttPort, _, err := docker.Mqtt(ctx, wg)
	if err != nil {
		t.Error(err)
		return
	}
	config.ZwaveMqttBroker = "tcp://localhost:" + zwaveMqttPort
	config.ZwaveMqttUser = ""
	config.ZwaveMqttPw = ""
	config.ZwaveMqttClientId = "connector-zwave"

	config.Debug = true
	config.UpdatePeriod = ""
	config.ConnectorId = "test-connector-id"
	config.DeviceTypeMapping = map[string]string{
		"0x0371.0x0002.881-7-2": "test-device-type",
	}

	c, err := lib.New(config, ctx)
	if err != nil {
		t.Error(err)
		return
	}

	mgwmqttclient := paho.NewClient(paho.NewClientOptions().
		SetAutoReconnect(true).
		SetCleanSession(false).
		SetClientID("test-client-mgw").
		AddBroker(config.MgwMqttBroker))
	if token := mgwmqttclient.Connect(); token.Wait() && token.Error() != nil {
		log.Println("Error on Mqtt.Connect(): ", token.Error())
		t.Error(err)
		return
	}
	defer mgwmqttclient.Disconnect(0)

	zwavemqttclient := paho.NewClient(paho.NewClientOptions().
		SetAutoReconnect(true).
		SetCleanSession(false).
		SetClientID("test-client-zwave").
		AddBroker(config.ZwaveMqttBroker))
	if token := zwavemqttclient.Connect(); token.Wait() && token.Error() != nil {
		log.Println("Error on Mqtt.Connect(): ", token.Error())
		t.Error(err)
		return
	}
	defer zwavemqttclient.Disconnect(0)

	t.Run("device-management", deviceManagementTest(c, mgwmqttclient, zwavemqttclient))
}

func deviceManagementTest(c *connector.Connector, mgwmqttclient paho.Client, zwavemqttclient paho.Client) func(t *testing.T) {
	return func(t *testing.T) {

		t.Run("check update trigger", checkUpdateTrigger(c, mgwmqttclient, zwavemqttclient))
		t.Run("check update result", checkUpdateResult(c, mgwmqttclient, zwavemqttclient))

	}
}

func checkUpdateTrigger(c *connector.Connector, mgwmqttclient paho.Client, zwavemqttclient paho.Client) func(t *testing.T) {
	return func(t *testing.T) {

		//check update request
		requestTopic := "zwave2mqtt/_CLIENTS/ZWAVE_GATEWAY-SENERGY/api/getNodes/set"
		requestDone, requestReceived := context.WithTimeout(context.Background(), 10*time.Second)
		token := zwavemqttclient.Subscribe(requestTopic, 2, func(_ paho.Client, message paho.Message) {
			defer requestReceived()
			expectedMsg := `{"args":[]}`
			if string(message.Payload()) != expectedMsg {
				t.Error(string(message.Payload()), "\n", expectedMsg)
				return
			}
		})
		if token.Wait() && token.Error() != nil {
			t.Error(token.Error())
			return
		}
		defer zwavemqttclient.Unsubscribe(requestTopic)

		//trigger update
		token = mgwmqttclient.Publish("device-manager/refresh", 2, false, "1")
		if token.Wait() && token.Error() != nil {
			t.Error(token.Error())
			return
		}

		<-requestDone.Done()
		if err := requestDone.Err(); err != nil && err != context.Canceled {
			t.Error("no update request received", err)
		}
	}
}

func checkUpdateResult(connector *connector.Connector, mgwmqttclient paho.Client, zwavemqttclient paho.Client) func(t *testing.T) {
	return func(t *testing.T) {
		//check update
		deviceInfoTopic := "device-manager/device/test-connector-id"
		deviceInfoDone, allDeviceInfosReceived := context.WithTimeout(context.Background(), 10*time.Second)
		wg := sync.WaitGroup{}
		wg.Add(2)
		go func() {
			wg.Wait()
			allDeviceInfosReceived()
		}()
		token := mgwmqttclient.Subscribe(deviceInfoTopic, 2, func(_ paho.Client, message paho.Message) {
			defer wg.Done()
			expectedMsg1 := `{"method":"set","device_id":"test-connector-id:3","data":{"name":"Test","state":"online","device_type":"test-device-type"}}`
			expectedMsg12 := `{"method":"set","device_id":"test-connector-id:4","data":{"name":"ZWA008 Door Window Sensor 7 (4)","state":"online","device_type":"test-device-type"}}`
			if string(message.Payload()) != expectedMsg1 && string(message.Payload()) != expectedMsg12 {
				t.Error(string(message.Payload()))
				return
			}
		})
		if token.Wait() && token.Error() != nil {
			t.Error(token.Error())
			return
		}
		defer mgwmqttclient.Unsubscribe(deviceInfoTopic)

		//send update
		updatePayload := `{"success":true,"message":"Success zwave api call","result":[{"node_id":0,"type":"Main controller","status":"","name":"","loc":"","failed":true,"values":{}},{"node_id":1,"device_id":"134-90-1","manufacturer":"AEON Labs","manufacturerid":"0x0086","product":"ZW090 Z-Stick Gen5 EU","producttype":"0x0001","productid":"0x005a","type":"Static PC Controller","values":{"32-1-0":{"value_id":"1-32-1-0","node_id":1,"class_id":32,"type":"byte","genre":"basic","instance":1,"index":0,"label":"Basic","units":"","help":"Basic status of the node","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611654895645},"32-1-1":{"value_id":"1-32-1-1","node_id":1,"class_id":32,"type":"byte","genre":"basic","instance":1,"index":1,"label":"Basic Target","units":"","help":"","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611654895646},"32-1-2":{"value_id":"1-32-1-2","node_id":1,"class_id":32,"type":"int","genre":"basic","instance":1,"index":2,"label":"Basic Duration","units":"","help":"","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":0,"lastUpdate":1611654895646},"112-1-81":{"value_id":"1-112-1-81","node_id":1,"class_id":112,"type":"list","genre":"config","instance":1,"index":81,"label":"LED indicator configuration","units":"","help":"Enable/Disable LED indicator when plugged in","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Enable","lastUpdate":1611654895646},"112-1-220":{"value_id":"1-112-1-220","node_id":1,"class_id":112,"type":"list","genre":"config","instance":1,"index":220,"label":"Configuration of the RF power level","units":"","help":"1~10, other= ignore. A total of 10 levels, level 1 as the weak output power, and so on, 10 for most output power level","read_only":false,"write_only":false,"min":1,"max":10,"is_polled":false,"values":["1","2","3","4","5","6","7","8","9","10"],"value":"10","lastUpdate":1611654895647},"112-1-242":{"value_id":"1-112-1-242","node_id":1,"class_id":112,"type":"list","genre":"config","instance":1,"index":242,"label":"Security network enabled","units":"","help":"","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Disable","lastUpdate":1611654895647},"112-1-243":{"value_id":"1-112-1-243","node_id":1,"class_id":112,"type":"int","genre":"config","instance":1,"index":243,"label":"Security network key","units":"","help":"","read_only":false,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":0,"lastUpdate":1611654895647},"112-1-252":{"value_id":"1-112-1-252","node_id":1,"class_id":112,"type":"list","genre":"config","instance":1,"index":252,"label":"Lock/Unlock Configuration","units":"","help":"Lock/ unlock all configuration parameters","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Unlock","Lock"],"value":"Unlock","lastUpdate":1611654895647},"112-1-255":{"value_id":"1-112-1-255","node_id":1,"class_id":112,"type":"int","genre":"config","instance":1,"index":255,"label":"Reset default configuration","units":"","help":"Reset to the default configuration","read_only":false,"write_only":true,"min":-2147483648,"max":2147483647,"is_polled":false,"value":0,"lastUpdate":1611654895647},"114-1-0":{"value_id":"1-114-1-0","node_id":1,"class_id":114,"type":"int","genre":"system","instance":1,"index":0,"label":"Loaded Config Revision","units":"","help":"Revision of the Config file currently loaded","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":6,"lastUpdate":1611654895648},"114-1-1":{"value_id":"1-114-1-1","node_id":1,"class_id":114,"type":"int","genre":"system","instance":1,"index":1,"label":"Config File Revision","units":"","help":"Revision of the Config file on the File System","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":6,"lastUpdate":1611654895648},"114-1-2":{"value_id":"1-114-1-2","node_id":1,"class_id":114,"type":"int","genre":"system","instance":1,"index":2,"label":"Latest Available Config File Revision","units":"","help":"Latest Revision of the Config file available for download","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":6,"lastUpdate":1611654895648}},"groups":[],"neighborns":[3,4,5],"ready":true,"available":true,"hassDevices":{},"failed":false,"lastActive":1611654895645,"status":"Alive","basic_device_class":2,"generic_device_class":2,"specific_device_class":1},{"node_id":2,"type":"","status":"Removed","name":"","loc":"","failed":true,"values":{}},{"node_id":3,"device_id":"881-7-2","manufacturer":"Aeotec Limited","manufacturerid":"0x0371","product":"ZWA008 Door Window Sensor 7","producttype":"0x0002","productid":"0x0007","type":"Access Control Sensor","name":"Test","values":{"32-1-0":{"value_id":"3-32-1-0","node_id":3,"class_id":32,"type":"byte","genre":"basic","instance":1,"index":0,"label":"Basic","units":"","help":"Basic status of the node","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611655806624},"32-1-1":{"value_id":"3-32-1-1","node_id":3,"class_id":32,"type":"byte","genre":"basic","instance":1,"index":1,"label":"Basic Target","units":"","help":"","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611655806624},"32-1-2":{"value_id":"3-32-1-2","node_id":3,"class_id":32,"type":"int","genre":"basic","instance":1,"index":2,"label":"Basic Duration","units":"","help":"","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":0,"lastUpdate":1611655806624},"48-1-0":{"value_id":"3-48-1-0","node_id":3,"class_id":48,"type":"bool","genre":"user","instance":1,"index":0,"label":"Sensor","units":"","help":"Binary Sensor State","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":false,"lastUpdate":1611655806625},"91-1-1":{"value_id":"3-91-1-1","node_id":3,"class_id":91,"type":"list","genre":"user","instance":1,"index":1,"label":"Scene 1","units":"","help":"","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Inactive","Pressed 1 Time","Key Released","Key Held down","Pressed 2 Times","Pressed 3 Times","Pressed 4 Times","Pressed 5 Times"],"value":"Inactive","lastUpdate":1611655806625},"91-1-256":{"value_id":"3-91-1-256","node_id":3,"class_id":91,"type":"int","genre":"user","instance":1,"index":256,"label":"Scene Count","units":"","help":"","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611655806625},"91-1-257":{"value_id":"3-91-1-257","node_id":3,"class_id":91,"type":"int","genre":"config","instance":1,"index":257,"label":"Scene Reset Timeout","units":"","help":"","read_only":false,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1000,"lastUpdate":1611655806625},"94-1-0":{"value_id":"3-94-1-0","node_id":3,"class_id":94,"type":"byte","genre":"system","instance":1,"index":0,"label":"ZWave+ Version","units":"","help":"ZWave+ Version Supported on the Device","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":1,"lastUpdate":1611655806625},"94-1-1":{"value_id":"3-94-1-1","node_id":3,"class_id":94,"type":"short","genre":"system","instance":1,"index":1,"label":"InstallerIcon","units":"","help":"Icon File to use for the Installer Application","read_only":true,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":3072,"lastUpdate":1611655806625},"94-1-2":{"value_id":"3-94-1-2","node_id":3,"class_id":94,"type":"short","genre":"system","instance":1,"index":2,"label":"UserIcon","units":"","help":"Icon File to use for the User Application","read_only":true,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":3078,"lastUpdate":1611655806625},"112-1-1":{"value_id":"3-112-1-1","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":1,"label":"Operation mode","units":"","help":"Parameter defines device operation mode.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Built-in hall sensor","External Input"],"value":"Built-in hall sensor","lastUpdate":1611655806626},"112-1-2":{"value_id":"3-112-1-2","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":2,"label":"Door/Window or alarm status","units":"","help":"Parameter defines state of the sensor when the magnet is close. If the alarm sensor is connected, it determines the output type. Parameter inactive in external button mode (parameter Operation Mode set to 1).","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Closed","Opened"],"value":"Closed","lastUpdate":1611655806626},"112-1-3":{"value_id":"3-112-1-3","node_id":3,"class_id":112,"type":"byte","genre":"config","instance":1,"index":3,"label":"Visual LED indications","units":"","help":"This parameter defines events indicated by the visual LED indicator. Disabling events might extend battery life. Values of parameters may be combined, e.g. 1+2=3 means opening/closing and wake up will be indicated by the visual indicator. 0 - No indications. 1 - Indication of opening/closing status change (input In). 2 - Indication of wake up (1 x click or periodical). 4 - Indication of device tampering.","read_only":false,"write_only":false,"min":0,"max":7,"is_polled":false,"value":7,"lastUpdate":1611655806626},"112-1-4":{"value_id":"3-112-1-4","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":4,"label":"Range test after double click","units":"","help":"Allows to enable activation of Z-Wave range test with double click of a Tamper Switch 2.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Disable","lastUpdate":1611655806626},"112-1-5":{"value_id":"3-112-1-5","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":5,"label":"2nd Association Group triggers","units":"","help":"Parameter defines events which result in sending On/Off commands to devices added to the 2nd Association Group. These commands are sent alternately to switch the devices On and Off. Commands represent the values of BASIC SET command frames. Parameter is inactive in external dry-contact mode (parameter Operation Mode set to 1).","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Switch after opening and closing","Switch after opening","Switch after closing"],"value":"Switch after opening and closing","lastUpdate":1611655806626},"112-1-6":{"value_id":"3-112-1-6","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":6,"label":"Commands sent to 2nd Association Group","units":"","help":"Command frames sent to devices added to the 2nd association group.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["On","Off","On and Off"],"value":"On and Off","lastUpdate":1611655806626},"112-1-7":{"value_id":"3-112-1-7","node_id":3,"class_id":112,"type":"byte","genre":"config","instance":1,"index":7,"label":"Value of ON command frame sent to 2nd Association Group","units":"","help":"The value of 0 turns OFF the device, 255 turns it On. In case of associating the Dimmer or Roller Shutter module, values 1-99 allow to set an Associated device to a specified level.","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":255,"lastUpdate":1611655806626},"112-1-8":{"value_id":"3-112-1-8","node_id":3,"class_id":112,"type":"byte","genre":"config","instance":1,"index":8,"label":"Value of OFF command frame sent to 2nd Association Group","units":"","help":"The value of 0 turns OFF the device, 255 turns it On. In case of associating the Dimmer or Roller Shutter module, values 1-99 allow to set an Associated device to a specified level.","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611655806627},"112-1-9":{"value_id":"3-112-1-9","node_id":3,"class_id":112,"type":"short","genre":"config","instance":1,"index":9,"label":"Time delay of ON command frame","units":"seconds","help":"Time period after which On command frame will be sent.","read_only":false,"write_only":false,"min":0,"max":32400,"is_polled":false,"value":0,"lastUpdate":1611655806627},"112-1-10":{"value_id":"3-112-1-10","node_id":3,"class_id":112,"type":"short","genre":"config","instance":1,"index":10,"label":"Time delay of OFF command frame","units":"seconds","help":"Time period after which Off command frame will be sent.","read_only":false,"write_only":false,"min":0,"max":32400,"is_polled":false,"value":0,"lastUpdate":1611655806627},"112-1-11":{"value_id":"3-112-1-11","node_id":3,"class_id":112,"type":"short","genre":"config","instance":1,"index":11,"label":"Delay of tamper alarm cancellation","units":"seconds","help":"Time period after which a tamper alarm will be cancelled.","read_only":false,"write_only":false,"min":0,"max":32400,"is_polled":false,"value":5,"lastUpdate":1611655806627},"112-1-12":{"value_id":"3-112-1-12","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":12,"label":"Reporting tamper alarm cancellation","units":"","help":"Reporting cancellation of tamper alarm to the controller and 5th Association Group.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Do not send tamper cancellation report","Send tamper cancellation report"],"value":"Send tamper cancellation report","lastUpdate":1611655806627},"112-1-13":{"value_id":"3-112-1-13","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":13,"label":"Scene activation functionality","units":"","help":"The device can trigger scenes via Dry Input Terminal (external contact) using scene IDs assigned to different events.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Disable","lastUpdate":1611655806627},"112-1-14":{"value_id":"3-112-1-14","node_id":3,"class_id":112,"type":"list","genre":"config","instance":1,"index":14,"label":"Tilt Sensor functionality","units":"","help":"The device can report Tilt Window events. This functionality can be disabled if the device is mounted on a door or windows without tilt functionality.To disable tilt detection set the value to 0.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Enable","lastUpdate":1611655806627},"113-1-6":{"value_id":"3-113-1-6","node_id":3,"class_id":113,"type":"list","genre":"user","instance":1,"index":6,"label":"Access Control","units":"","help":"Access Control Alerts","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Clear","Door/Window Open","Door/Window Closed"],"value":"Door/Window Closed","lastUpdate":1611656048685},"113-1-7":{"value_id":"3-113-1-7","node_id":3,"class_id":113,"type":"list","genre":"user","instance":1,"index":7,"label":"Home Security","units":"","help":"Home Security Alerts","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Clear","Tampering -  Cover Removed"],"value":"Tampering -  Cover Removed","lastUpdate":1611655890618},"113-1-256":{"value_id":"3-113-1-256","node_id":3,"class_id":113,"type":"byte","genre":"user","instance":1,"index":256,"label":"Previous Event Cleared","units":"","help":"Previous Event that was sent","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":3,"lastUpdate":1611655806628},"114-1-0":{"value_id":"3-114-1-0","node_id":3,"class_id":114,"type":"int","genre":"system","instance":1,"index":0,"label":"Loaded Config Revision","units":"","help":"Revision of the Config file currently loaded","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611655806628},"114-1-1":{"value_id":"3-114-1-1","node_id":3,"class_id":114,"type":"int","genre":"system","instance":1,"index":1,"label":"Config File Revision","units":"","help":"Revision of the Config file on the File System","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611655806628},"114-1-2":{"value_id":"3-114-1-2","node_id":3,"class_id":114,"type":"int","genre":"system","instance":1,"index":2,"label":"Latest Available Config File Revision","units":"","help":"Latest Revision of the Config file available for download","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611655806628},"114-1-4":{"value_id":"3-114-1-4","node_id":3,"class_id":114,"type":"string","genre":"system","instance":1,"index":4,"label":"Serial Number","units":"","help":"Device Serial Number","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"311306ae4dac6ffa0001ffff","lastUpdate":1611655806628},"115-1-0":{"value_id":"3-115-1-0","node_id":3,"class_id":115,"type":"list","genre":"system","instance":1,"index":0,"label":"Powerlevel","units":"dB","help":"Output RF PowerLevel","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Normal","-1dB","-2dB","-3dB","-4dB","-5dB","-6dB","-7dB","-8dB","-9dB"],"value":"Normal","lastUpdate":1611655806629},"115-1-1":{"value_id":"3-115-1-1","node_id":3,"class_id":115,"type":"byte","genre":"system","instance":1,"index":1,"label":"Timeout","units":"seconds","help":"Timeout till the PowerLevel is reset to Normal","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611655806629},"115-1-2":{"value_id":"3-115-1-2","node_id":3,"class_id":115,"type":"button","genre":"system","instance":1,"index":2,"label":"Set Powerlevel","units":"","help":"Apply the Output PowerLevel and Timeout Values","read_only":false,"write_only":true,"min":0,"max":0,"is_polled":false,"lastUpdate":1611655806629},"115-1-3":{"value_id":"3-115-1-3","node_id":3,"class_id":115,"type":"byte","genre":"system","instance":1,"index":3,"label":"Test Node","units":"","help":"Node to Perform a test against","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611655806629},"115-1-4":{"value_id":"3-115-1-4","node_id":3,"class_id":115,"type":"list","genre":"system","instance":1,"index":4,"label":"Test Powerlevel","units":"dB","help":"PowerLevel to use for the Test","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Normal","-1dB","-2dB","-3dB","-4dB","-5dB","-6dB","-7dB","-8dB","-9dB"],"value":"Normal","lastUpdate":1611655806629},"115-1-5":{"value_id":"3-115-1-5","node_id":3,"class_id":115,"type":"short","genre":"system","instance":1,"index":5,"label":"Frame Count","units":"","help":"How Many Messages to send to the Node for the Test","read_only":false,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":0,"lastUpdate":1611655806629},"115-1-6":{"value_id":"3-115-1-6","node_id":3,"class_id":115,"type":"button","genre":"system","instance":1,"index":6,"label":"Test","units":"","help":"Perform a PowerLevel Test against the a Node","read_only":false,"write_only":true,"min":0,"max":0,"is_polled":false,"lastUpdate":1611655806629},"115-1-7":{"value_id":"3-115-1-7","node_id":3,"class_id":115,"type":"button","genre":"system","instance":1,"index":7,"label":"Report","units":"","help":"Get the results of the latest PowerLevel Test against a Node","read_only":false,"write_only":true,"min":0,"max":0,"is_polled":false,"lastUpdate":1611655806629},"115-1-8":{"value_id":"3-115-1-8","node_id":3,"class_id":115,"type":"list","genre":"system","instance":1,"index":8,"label":"Test Status","units":"","help":"The Current Status of the last PowerNode Test Executed","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Failed","Success","In Progress"],"value":"Failed","lastUpdate":1611655806630},"115-1-9":{"value_id":"3-115-1-9","node_id":3,"class_id":115,"type":"short","genre":"system","instance":1,"index":9,"label":"Acked Frames","units":"","help":"Number of Messages successfully Acked by the Target Node","read_only":true,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":0,"lastUpdate":1611655806630},"128-1-0":{"value_id":"3-128-1-0","node_id":3,"class_id":128,"type":"byte","genre":"user","instance":1,"index":0,"label":"Battery Level","units":"%","help":"Current Battery Level","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":100,"lastUpdate":1611655890458},"132-1-0":{"value_id":"3-132-1-0","node_id":3,"class_id":132,"type":"int","genre":"system","instance":1,"index":0,"label":"Wake-up Interval","units":"Seconds","help":"How often the Device will Wake up to check for pending commands","read_only":false,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":86400,"lastUpdate":1611655806630},"132-1-1":{"value_id":"3-132-1-1","node_id":3,"class_id":132,"type":"int","genre":"system","instance":1,"index":1,"label":"Minimum Wake-up Interval","units":"Seconds","help":"Minimum Time in seconds the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":3600,"lastUpdate":1611655806630},"132-1-2":{"value_id":"3-132-1-2","node_id":3,"class_id":132,"type":"int","genre":"system","instance":1,"index":2,"label":"Maximum Wake-up Interval","units":"Seconds","help":"Maximum Time in seconds the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":15728400,"lastUpdate":1611655806630},"132-1-3":{"value_id":"3-132-1-3","node_id":3,"class_id":132,"type":"int","genre":"system","instance":1,"index":3,"label":"Default Wake-up Interval","units":"Seconds","help":"The Default Wake-Up Interval the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":86400,"lastUpdate":1611655806630},"132-1-4":{"value_id":"3-132-1-4","node_id":3,"class_id":132,"type":"int","genre":"system","instance":1,"index":4,"label":"Wake-up Interval Step","units":"Seconds","help":"Step Size on Wake-up interval","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":900,"lastUpdate":1611655806630},"134-1-0":{"value_id":"3-134-1-0","node_id":3,"class_id":134,"type":"string","genre":"system","instance":1,"index":0,"label":"Library Version","units":"","help":"Z-Wave Library Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"3","lastUpdate":1611655806631},"134-1-1":{"value_id":"3-134-1-1","node_id":3,"class_id":134,"type":"string","genre":"system","instance":1,"index":1,"label":"Protocol Version","units":"","help":"Z-Wave Protocol Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"6.07","lastUpdate":1611655806631},"134-1-2":{"value_id":"3-134-1-2","node_id":3,"class_id":134,"type":"string","genre":"system","instance":1,"index":2,"label":"Application Version","units":"","help":"Application Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"1.01","lastUpdate":1611655806631}},"groups":[{"text":"Lifeline","value":1},{"text":"Control","value":2},{"text":"Alarm sensor","value":3},{"text":"Alarm tamper","value":4},{"text":"Lifeline","value":1},{"text":"Control","value":2},{"text":"Alarm sensor","value":3},{"text":"Alarm tamper","value":4}],"neighborns":[1],"ready":true,"available":true,"hassDevices":{},"failed":false,"lastActive":1611656071049,"status":"Alive","basic_device_class":4,"generic_device_class":7,"specific_device_class":1,"version":"1.01"},{"node_id":4,"device_id":"881-7-2","manufacturer":"Aeotec Limited","manufacturerid":"0x0371","product":"ZWA008 Door Window Sensor 7","producttype":"0x0002","productid":"0x0007","type":"Access Control Sensor","values":{"32-1-0":{"value_id":"4-32-1-0","node_id":4,"class_id":32,"type":"byte","genre":"basic","instance":1,"index":0,"label":"Basic","units":"","help":"Basic status of the node","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611667140510},"32-1-1":{"value_id":"4-32-1-1","node_id":4,"class_id":32,"type":"byte","genre":"basic","instance":1,"index":1,"label":"Basic Target","units":"","help":"","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611667140510},"32-1-2":{"value_id":"4-32-1-2","node_id":4,"class_id":32,"type":"int","genre":"basic","instance":1,"index":2,"label":"Basic Duration","units":"","help":"","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":0,"lastUpdate":1611667140511},"48-1-0":{"value_id":"4-48-1-0","node_id":4,"class_id":48,"type":"bool","genre":"user","instance":1,"index":0,"label":"Sensor","units":"","help":"Binary Sensor State","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":false,"lastUpdate":1611667140511},"91-1-1":{"value_id":"4-91-1-1","node_id":4,"class_id":91,"type":"list","genre":"user","instance":1,"index":1,"label":"Scene 1","units":"","help":"","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Inactive","Pressed 1 Time","Key Released","Key Held down","Pressed 2 Times","Pressed 3 Times","Pressed 4 Times","Pressed 5 Times"],"value":"Inactive","lastUpdate":1611667140511},"91-1-256":{"value_id":"4-91-1-256","node_id":4,"class_id":91,"type":"int","genre":"user","instance":1,"index":256,"label":"Scene Count","units":"","help":"","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611667140511},"91-1-257":{"value_id":"4-91-1-257","node_id":4,"class_id":91,"type":"int","genre":"config","instance":1,"index":257,"label":"Scene Reset Timeout","units":"","help":"","read_only":false,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1000,"lastUpdate":1611667140511},"94-1-0":{"value_id":"4-94-1-0","node_id":4,"class_id":94,"type":"byte","genre":"system","instance":1,"index":0,"label":"ZWave+ Version","units":"","help":"ZWave+ Version Supported on the Device","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":1,"lastUpdate":1611667140511},"94-1-1":{"value_id":"4-94-1-1","node_id":4,"class_id":94,"type":"short","genre":"system","instance":1,"index":1,"label":"InstallerIcon","units":"","help":"Icon File to use for the Installer Application","read_only":true,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":3072,"lastUpdate":1611667140512},"94-1-2":{"value_id":"4-94-1-2","node_id":4,"class_id":94,"type":"short","genre":"system","instance":1,"index":2,"label":"UserIcon","units":"","help":"Icon File to use for the User Application","read_only":true,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":3078,"lastUpdate":1611667140512},"112-1-1":{"value_id":"4-112-1-1","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":1,"label":"Operation mode","units":"","help":"Parameter defines device operation mode.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Built-in hall sensor","External Input"],"value":"Built-in hall sensor","lastUpdate":1611667140512},"112-1-2":{"value_id":"4-112-1-2","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":2,"label":"Door/Window or alarm status","units":"","help":"Parameter defines state of the sensor when the magnet is close. If the alarm sensor is connected, it determines the output type. Parameter inactive in external button mode (parameter Operation Mode set to 1).","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Closed","Opened"],"value":"Closed","lastUpdate":1611667140512},"112-1-3":{"value_id":"4-112-1-3","node_id":4,"class_id":112,"type":"byte","genre":"config","instance":1,"index":3,"label":"Visual LED indications","units":"","help":"This parameter defines events indicated by the visual LED indicator. Disabling events might extend battery life. Values of parameters may be combined, e.g. 1+2=3 means opening/closing and wake up will be indicated by the visual indicator. 0 - No indications. 1 - Indication of opening/closing status change (input In). 2 - Indication of wake up (1 x click or periodical). 4 - Indication of device tampering.","read_only":false,"write_only":false,"min":0,"max":7,"is_polled":false,"value":7,"lastUpdate":1611667140512},"112-1-4":{"value_id":"4-112-1-4","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":4,"label":"Range test after double click","units":"","help":"Allows to enable activation of Z-Wave range test with double click of a Tamper Switch 2.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Disable","lastUpdate":1611667140512},"112-1-5":{"value_id":"4-112-1-5","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":5,"label":"2nd Association Group triggers","units":"","help":"Parameter defines events which result in sending On/Off commands to devices added to the 2nd Association Group. These commands are sent alternately to switch the devices On and Off. Commands represent the values of BASIC SET command frames. Parameter is inactive in external dry-contact mode (parameter Operation Mode set to 1).","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Switch after opening and closing","Switch after opening","Switch after closing"],"value":"Switch after opening and closing","lastUpdate":1611667140513},"112-1-6":{"value_id":"4-112-1-6","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":6,"label":"Commands sent to 2nd Association Group","units":"","help":"Command frames sent to devices added to the 2nd association group.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["On","Off","On and Off"],"value":"On and Off","lastUpdate":1611667140513},"112-1-7":{"value_id":"4-112-1-7","node_id":4,"class_id":112,"type":"byte","genre":"config","instance":1,"index":7,"label":"Value of ON command frame sent to 2nd Association Group","units":"","help":"The value of 0 turns OFF the device, 255 turns it On. In case of associating the Dimmer or Roller Shutter module, values 1-99 allow to set an Associated device to a specified level.","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":255,"lastUpdate":1611667140513},"112-1-8":{"value_id":"4-112-1-8","node_id":4,"class_id":112,"type":"byte","genre":"config","instance":1,"index":8,"label":"Value of OFF command frame sent to 2nd Association Group","units":"","help":"The value of 0 turns OFF the device, 255 turns it On. In case of associating the Dimmer or Roller Shutter module, values 1-99 allow to set an Associated device to a specified level.","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611667140513},"112-1-9":{"value_id":"4-112-1-9","node_id":4,"class_id":112,"type":"short","genre":"config","instance":1,"index":9,"label":"Time delay of ON command frame","units":"seconds","help":"Time period after which On command frame will be sent.","read_only":false,"write_only":false,"min":0,"max":32400,"is_polled":false,"value":0,"lastUpdate":1611667140513},"112-1-10":{"value_id":"4-112-1-10","node_id":4,"class_id":112,"type":"short","genre":"config","instance":1,"index":10,"label":"Time delay of OFF command frame","units":"seconds","help":"Time period after which Off command frame will be sent.","read_only":false,"write_only":false,"min":0,"max":32400,"is_polled":false,"value":0,"lastUpdate":1611667140513},"112-1-11":{"value_id":"4-112-1-11","node_id":4,"class_id":112,"type":"short","genre":"config","instance":1,"index":11,"label":"Delay of tamper alarm cancellation","units":"seconds","help":"Time period after which a tamper alarm will be cancelled.","read_only":false,"write_only":false,"min":0,"max":32400,"is_polled":false,"value":5,"lastUpdate":1611667140513},"112-1-12":{"value_id":"4-112-1-12","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":12,"label":"Reporting tamper alarm cancellation","units":"","help":"Reporting cancellation of tamper alarm to the controller and 5th Association Group.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Do not send tamper cancellation report","Send tamper cancellation report"],"value":"Send tamper cancellation report","lastUpdate":1611667140514},"112-1-13":{"value_id":"4-112-1-13","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":13,"label":"Scene activation functionality","units":"","help":"The device can trigger scenes via Dry Input Terminal (external contact) using scene IDs assigned to different events.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Disable","lastUpdate":1611667140514},"112-1-14":{"value_id":"4-112-1-14","node_id":4,"class_id":112,"type":"list","genre":"config","instance":1,"index":14,"label":"Tilt Sensor functionality","units":"","help":"The device can report Tilt Window events. This functionality can be disabled if the device is mounted on a door or windows without tilt functionality.To disable tilt detection set the value to 0.","read_only":false,"write_only":false,"min":0,"max":1,"is_polled":false,"values":["Disable","Enable"],"value":"Enable","lastUpdate":1611667140514},"113-1-6":{"value_id":"4-113-1-6","node_id":4,"class_id":113,"type":"list","genre":"user","instance":1,"index":6,"label":"Access Control","units":"","help":"Access Control Alerts","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Clear","Door/Window Open","Door/Window Closed"],"value":"Door/Window Closed","lastUpdate":1611823204023},"113-1-7":{"value_id":"4-113-1-7","node_id":4,"class_id":113,"type":"list","genre":"user","instance":1,"index":7,"label":"Home Security","units":"","help":"Home Security Alerts","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Clear","Tampering -  Cover Removed"],"value":"Clear","lastUpdate":1611667140514},"113-1-256":{"value_id":"4-113-1-256","node_id":4,"class_id":113,"type":"byte","genre":"user","instance":1,"index":256,"label":"Previous Event Cleared","units":"","help":"Previous Event that was sent","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611667140514},"114-1-0":{"value_id":"4-114-1-0","node_id":4,"class_id":114,"type":"int","genre":"system","instance":1,"index":0,"label":"Loaded Config Revision","units":"","help":"Revision of the Config file currently loaded","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611667140515},"114-1-1":{"value_id":"4-114-1-1","node_id":4,"class_id":114,"type":"int","genre":"system","instance":1,"index":1,"label":"Config File Revision","units":"","help":"Revision of the Config file on the File System","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611667140515},"114-1-2":{"value_id":"4-114-1-2","node_id":4,"class_id":114,"type":"int","genre":"system","instance":1,"index":2,"label":"Latest Available Config File Revision","units":"","help":"Latest Revision of the Config file available for download","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1,"lastUpdate":1611667140515},"114-1-4":{"value_id":"4-114-1-4","node_id":4,"class_id":114,"type":"string","genre":"system","instance":1,"index":4,"label":"Serial Number","units":"","help":"Device Serial Number","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"311306ae67316f4d0001ffff","lastUpdate":1611667140515},"115-1-0":{"value_id":"4-115-1-0","node_id":4,"class_id":115,"type":"list","genre":"system","instance":1,"index":0,"label":"Powerlevel","units":"dB","help":"Output RF PowerLevel","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Normal","-1dB","-2dB","-3dB","-4dB","-5dB","-6dB","-7dB","-8dB","-9dB"],"value":"Normal","lastUpdate":1611667140515},"115-1-1":{"value_id":"4-115-1-1","node_id":4,"class_id":115,"type":"byte","genre":"system","instance":1,"index":1,"label":"Timeout","units":"seconds","help":"Timeout till the PowerLevel is reset to Normal","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611667140515},"115-1-2":{"value_id":"4-115-1-2","node_id":4,"class_id":115,"type":"button","genre":"system","instance":1,"index":2,"label":"Set Powerlevel","units":"","help":"Apply the Output PowerLevel and Timeout Values","read_only":false,"write_only":true,"min":0,"max":0,"is_polled":false,"lastUpdate":1611667140515},"115-1-3":{"value_id":"4-115-1-3","node_id":4,"class_id":115,"type":"byte","genre":"system","instance":1,"index":3,"label":"Test Node","units":"","help":"Node to Perform a test against","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":0,"lastUpdate":1611667140516},"115-1-4":{"value_id":"4-115-1-4","node_id":4,"class_id":115,"type":"list","genre":"system","instance":1,"index":4,"label":"Test Powerlevel","units":"dB","help":"PowerLevel to use for the Test","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Normal","-1dB","-2dB","-3dB","-4dB","-5dB","-6dB","-7dB","-8dB","-9dB"],"value":"Normal","lastUpdate":1611667140516},"115-1-5":{"value_id":"4-115-1-5","node_id":4,"class_id":115,"type":"short","genre":"system","instance":1,"index":5,"label":"Frame Count","units":"","help":"How Many Messages to send to the Node for the Test","read_only":false,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":0,"lastUpdate":1611667140516},"115-1-6":{"value_id":"4-115-1-6","node_id":4,"class_id":115,"type":"button","genre":"system","instance":1,"index":6,"label":"Test","units":"","help":"Perform a PowerLevel Test against the a Node","read_only":false,"write_only":true,"min":0,"max":0,"is_polled":false,"lastUpdate":1611667140516},"115-1-7":{"value_id":"4-115-1-7","node_id":4,"class_id":115,"type":"button","genre":"system","instance":1,"index":7,"label":"Report","units":"","help":"Get the results of the latest PowerLevel Test against a Node","read_only":false,"write_only":true,"min":0,"max":0,"is_polled":false,"lastUpdate":1611667140516},"115-1-8":{"value_id":"4-115-1-8","node_id":4,"class_id":115,"type":"list","genre":"system","instance":1,"index":8,"label":"Test Status","units":"","help":"The Current Status of the last PowerNode Test Executed","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Failed","Success","In Progress"],"value":"Failed","lastUpdate":1611667140516},"115-1-9":{"value_id":"4-115-1-9","node_id":4,"class_id":115,"type":"short","genre":"system","instance":1,"index":9,"label":"Acked Frames","units":"","help":"Number of Messages successfully Acked by the Target Node","read_only":true,"write_only":false,"min":-32768,"max":32767,"is_polled":false,"value":0,"lastUpdate":1611667140516},"128-1-0":{"value_id":"4-128-1-0","node_id":4,"class_id":128,"type":"byte","genre":"user","instance":1,"index":0,"label":"Battery Level","units":"%","help":"Current Battery Level","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":100,"lastUpdate":1611763775844},"132-1-0":{"value_id":"4-132-1-0","node_id":4,"class_id":132,"type":"int","genre":"system","instance":1,"index":0,"label":"Wake-up Interval","units":"Seconds","help":"How often the Device will Wake up to check for pending commands","read_only":false,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":86400,"lastUpdate":1611667140517},"132-1-1":{"value_id":"4-132-1-1","node_id":4,"class_id":132,"type":"int","genre":"system","instance":1,"index":1,"label":"Minimum Wake-up Interval","units":"Seconds","help":"Minimum Time in seconds the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":3600,"lastUpdate":1611667140517},"132-1-2":{"value_id":"4-132-1-2","node_id":4,"class_id":132,"type":"int","genre":"system","instance":1,"index":2,"label":"Maximum Wake-up Interval","units":"Seconds","help":"Maximum Time in seconds the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":15728400,"lastUpdate":1611667140517},"132-1-3":{"value_id":"4-132-1-3","node_id":4,"class_id":132,"type":"int","genre":"system","instance":1,"index":3,"label":"Default Wake-up Interval","units":"Seconds","help":"The Default Wake-Up Interval the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":86400,"lastUpdate":1611667140517},"132-1-4":{"value_id":"4-132-1-4","node_id":4,"class_id":132,"type":"int","genre":"system","instance":1,"index":4,"label":"Wake-up Interval Step","units":"Seconds","help":"Step Size on Wake-up interval","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":900,"lastUpdate":1611667140517},"134-1-0":{"value_id":"4-134-1-0","node_id":4,"class_id":134,"type":"string","genre":"system","instance":1,"index":0,"label":"Library Version","units":"","help":"Z-Wave Library Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"3","lastUpdate":1611667140517},"134-1-1":{"value_id":"4-134-1-1","node_id":4,"class_id":134,"type":"string","genre":"system","instance":1,"index":1,"label":"Protocol Version","units":"","help":"Z-Wave Protocol Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"6.07","lastUpdate":1611667140518},"134-1-2":{"value_id":"4-134-1-2","node_id":4,"class_id":134,"type":"string","genre":"system","instance":1,"index":2,"label":"Application Version","units":"","help":"Application Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"1.01","lastUpdate":1611667140518}},"groups":[{"text":"Lifeline","value":1},{"text":"Control","value":2},{"text":"Alarm sensor","value":3},{"text":"Alarm tamper","value":4},{"text":"Lifeline","value":1},{"text":"Control","value":2},{"text":"Alarm sensor","value":3},{"text":"Alarm tamper","value":4}],"neighborns":[1],"ready":true,"available":true,"hassDevices":{},"failed":false,"lastActive":1611823204024,"status":"Sleep","basic_device_class":4,"generic_device_class":7,"specific_device_class":1,"version":"1.01"},{"node_id":5,"device_id":"2-373-5","manufacturer":"Danfoss","manufacturerid":"0x0002","product":"Devolo Home Control Radiator Thermostat","producttype":"0x0005","productid":"0x0175","type":"Setpoint Thermostat","values":{"49-1-1":{"value_id":"5-49-1-1","node_id":5,"class_id":49,"type":"decimal","genre":"user","instance":1,"index":1,"label":"Air Temperature","units":"C","help":"Air Temperature Sensor Value","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":20,"lastUpdate":1611828459120},"49-1-256":{"value_id":"5-49-1-256","node_id":5,"class_id":49,"type":"list","genre":"system","instance":1,"index":256,"label":"Air Temperature Units","units":"","help":"Air Temperature Sensor Available Units","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":[],"value":"","lastUpdate":1611824111518},"67-1-1":{"value_id":"5-67-1-1","node_id":5,"class_id":67,"type":"decimal","genre":"user","instance":1,"index":1,"label":"Heating 1","units":"C","help":"Set the Thermostat Setpoint Heating 1","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"value":19,"lastUpdate":1611828459005},"70-1-1":{"value_id":"5-70-1-1","node_id":5,"class_id":70,"type":"schedule","genre":"user","instance":1,"index":1,"label":"Monday","units":"","help":"Schedule for Monday","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"lastUpdate":1611824111519},"70-1-2":{"value_id":"5-70-1-2","node_id":5,"class_id":70,"type":"schedule","genre":"user","instance":1,"index":2,"label":"Tuesday","units":"","help":"Schedule for Tuesday","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"lastUpdate":1611824111519},"70-1-3":{"value_id":"5-70-1-3","node_id":5,"class_id":70,"type":"schedule","genre":"user","instance":1,"index":3,"label":"Wednesday","units":"","help":"Schedule for Wednesday","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"lastUpdate":1611824111519},"70-1-4":{"value_id":"5-70-1-4","node_id":5,"class_id":70,"type":"schedule","genre":"user","instance":1,"index":4,"label":"Thursday","units":"","help":"Schedule for Thursday","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"lastUpdate":1611824111519},"70-1-5":{"value_id":"5-70-1-5","node_id":5,"class_id":70,"type":"schedule","genre":"user","instance":1,"index":5,"label":"Friday","units":"","help":"Schedule for Friday","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"lastUpdate":1611824111519},"70-1-6":{"value_id":"5-70-1-6","node_id":5,"class_id":70,"type":"schedule","genre":"user","instance":1,"index":6,"label":"Saturday","units":"","help":"Schedule for Saturday","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"lastUpdate":1611824111520},"70-1-7":{"value_id":"5-70-1-7","node_id":5,"class_id":70,"type":"schedule","genre":"user","instance":1,"index":7,"label":"Sunday","units":"","help":"Schedule for Sunday","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"lastUpdate":1611824111520},"70-1-8":{"value_id":"5-70-1-8","node_id":5,"class_id":70,"type":"list","genre":"user","instance":1,"index":8,"label":"Override State","units":"","help":"Override Schedule","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["None","Temporary","Permanent"],"value":"None","lastUpdate":1611828459062},"70-1-9":{"value_id":"5-70-1-9","node_id":5,"class_id":70,"type":"byte","genre":"user","instance":1,"index":9,"label":"Override Setback","units":"","help":"Override Setback","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":127,"lastUpdate":1611828459064},"114-1-0":{"value_id":"5-114-1-0","node_id":5,"class_id":114,"type":"int","genre":"system","instance":1,"index":0,"label":"Loaded Config Revision","units":"","help":"Revision of the Config file currently loaded","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":10,"lastUpdate":1611824111520},"114-1-1":{"value_id":"5-114-1-1","node_id":5,"class_id":114,"type":"int","genre":"system","instance":1,"index":1,"label":"Config File Revision","units":"","help":"Revision of the Config file on the File System","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":10,"lastUpdate":1611824111521},"114-1-2":{"value_id":"5-114-1-2","node_id":5,"class_id":114,"type":"int","genre":"system","instance":1,"index":2,"label":"Latest Available Config File Revision","units":"","help":"Latest Revision of the Config file available for download","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":10,"lastUpdate":1611824111521},"117-1-0":{"value_id":"5-117-1-0","node_id":5,"class_id":117,"type":"list","genre":"system","instance":1,"index":0,"label":"Protection","units":"","help":"Protect a device against unintentional control","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Unprotected","Protection by Sequence","No Operation Possible"],"value":"Unprotected","lastUpdate":1611824111521},"128-1-0":{"value_id":"5-128-1-0","node_id":5,"class_id":128,"type":"byte","genre":"user","instance":1,"index":0,"label":"Battery Level","units":"%","help":"Current Battery Level","read_only":true,"write_only":false,"min":0,"max":255,"is_polled":false,"value":69,"lastUpdate":1611828458950},"129-1-0":{"value_id":"5-129-1-0","node_id":5,"class_id":129,"type":"list","genre":"user","instance":1,"index":0,"label":"Day","units":"","help":"Day of Week","read_only":false,"write_only":false,"min":0,"max":0,"is_polled":false,"values":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"value":"Saturday","lastUpdate":1611824111521},"129-1-1":{"value_id":"5-129-1-1","node_id":5,"class_id":129,"type":"byte","genre":"user","instance":1,"index":1,"label":"Hour","units":"","help":"Hour","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":17,"lastUpdate":1611824111522},"129-1-2":{"value_id":"5-129-1-2","node_id":5,"class_id":129,"type":"byte","genre":"user","instance":1,"index":2,"label":"Minute","units":"","help":"Minute","read_only":false,"write_only":false,"min":0,"max":255,"is_polled":false,"value":10,"lastUpdate":1611824111522},"132-1-0":{"value_id":"5-132-1-0","node_id":5,"class_id":132,"type":"int","genre":"system","instance":1,"index":0,"label":"Wake-up Interval","units":"Seconds","help":"How often the Device will Wake up to check for pending commands","read_only":false,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":300,"lastUpdate":1611824111522},"132-1-1":{"value_id":"5-132-1-1","node_id":5,"class_id":132,"type":"int","genre":"system","instance":1,"index":1,"label":"Minimum Wake-up Interval","units":"Seconds","help":"Minimum Time in seconds the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":60,"lastUpdate":1611824111522},"132-1-2":{"value_id":"5-132-1-2","node_id":5,"class_id":132,"type":"int","genre":"system","instance":1,"index":2,"label":"Maximum Wake-up Interval","units":"Seconds","help":"Maximum Time in seconds the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":1800,"lastUpdate":1611824111522},"132-1-3":{"value_id":"5-132-1-3","node_id":5,"class_id":132,"type":"int","genre":"system","instance":1,"index":3,"label":"Default Wake-up Interval","units":"Seconds","help":"The Default Wake-Up Interval the device will wake up","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":300,"lastUpdate":1611824111522},"132-1-4":{"value_id":"5-132-1-4","node_id":5,"class_id":132,"type":"int","genre":"system","instance":1,"index":4,"label":"Wake-up Interval Step","units":"Seconds","help":"Step Size on Wake-up interval","read_only":true,"write_only":false,"min":-2147483648,"max":2147483647,"is_polled":false,"value":60,"lastUpdate":1611824111523},"134-1-0":{"value_id":"5-134-1-0","node_id":5,"class_id":134,"type":"string","genre":"system","instance":1,"index":0,"label":"Library Version","units":"","help":"Z-Wave Library Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"6","lastUpdate":1611824111523},"134-1-1":{"value_id":"5-134-1-1","node_id":5,"class_id":134,"type":"string","genre":"system","instance":1,"index":1,"label":"Protocol Version","units":"","help":"Z-Wave Protocol Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"3.67","lastUpdate":1611824111523},"134-1-2":{"value_id":"5-134-1-2","node_id":5,"class_id":134,"type":"string","genre":"system","instance":1,"index":2,"label":"Application Version","units":"","help":"Application Version","read_only":true,"write_only":false,"min":0,"max":0,"is_polled":false,"value":"1.00","lastUpdate":1611824111523}},"groups":[],"neighborns":[1],"ready":true,"available":true,"hassDevices":{},"failed":false,"lastActive":1611828460206,"status":"Sleep","basic_device_class":4,"generic_device_class":8,"specific_device_class":4,"version":"1.00"}],"args":[]}`
		token = zwavemqttclient.Publish("zwave2mqtt/_CLIENTS/ZWAVE_GATEWAY-SENERGY/api/getNodes", 2, false, updatePayload)
		if token.Wait() && token.Error() != nil {
			t.Error(token.Error())
			return
		}

		<-deviceInfoDone.Done()
		if err := deviceInfoDone.Err(); err != nil && err != context.Canceled {
			t.Error("no device-info received:", err)
		}
	}
}
